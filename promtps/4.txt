### ROLE

You are a **software architect and backend systems designer**.
Your next task is to **restructure and refine the entire backend folder hierarchy** for the **Next Subscription platform** to align with enterprise-level Node.js project standards.

---

### OBJECTIVE

Restructure, refactor, and document the backend architecture to follow **modern production-level best practices**, ensuring logical organization, optimized database use, and cleaner imports â€” without changing frontend or breaking APIs.

---

### PHASE 2 â€” BACKEND RESTRUCTURING & DATABASE REFINEMENT

#### ğŸ§  1. Understand the Current Structure

Before making any change, thoroughly analyze:

* Folder hierarchy (controllers, routes, services, utils, models).
* File import/export paths.
* How modules interact (especially database, vendor, and system routes).
* Current MongoDB collections and how they relate.

#### ğŸ“‚ 2. Implement Industry-Standard Folder Structure

Restructure backend as follows:

```
/backend
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/          # Environment, DB connections, constants
â”‚   â”œâ”€â”€ models/          # Mongoose schemas
â”‚   â”œâ”€â”€ controllers/     # Route handlers
â”‚   â”œâ”€â”€ services/        # Business logic (non-HTTP)
â”‚   â”œâ”€â”€ routes/          # Express routers
â”‚   â”œâ”€â”€ middleware/      # Request validation, auth, error handling
â”‚   â”œâ”€â”€ utils/           # Helper functions and common utilities
â”‚   â”œâ”€â”€ logs/            # System and error logs
â”‚   â”œâ”€â”€ tests/           # Backend unit/integration tests
â”‚   â””â”€â”€ app.js           # Express app setup
â””â”€â”€ server.js            # Entry point
```

All route imports and relative paths must be updated accordingly.

#### ğŸ§± 3. Refactor Database Collections

* Identify redundant collections (e.g., if `vendor_logs`, `vendor_activity`, and `audit_logs` overlap).
* Merge related collections where possible:

  * Combine all logs into `system_logs` with type identifiers.
  * Use `vendors`, `users`, `products`, and `subscriptions` as core collections.
* Implement database indexes for high-frequency queries.
* Use **lean()** for lightweight query reads.
* Simplify schemas by removing unused fields or renaming confusing ones (e.g., `is_verified` â†’ `verified`).

#### âš™ï¸ 4. Improve Configurations & Constants

* Create `/src/config/constants.js` with all static keys, like:

  ```js
  export const SYSTEM_STATUS = { OK: "ok", ERROR: "error" };
  ```
* Move ENV checks to `/src/config/env.js`.
* Ensure `.env.example` is updated with required keys.

#### ğŸ§© 5. Add Inline Documentation

Add at least one meaningful comment per function:

```js
// SERVICE: Handles all CRUD operations for vendors
```

Each folder should include a short `README.md` explaining its purpose.

#### ğŸ§  6. Verify Import Integrity

* After renaming/moving files, ensure all import paths are updated correctly.
* Use absolute imports where possible (via `module-alias` or `tsconfig paths`).
* Rebuild the project to confirm zero missing module errors.

#### ğŸ§® 7. Database Optimization

* Review data models:

  * Add compound indexes for search-heavy queries.
  * Apply schema-level validation using Mongoose validators.
* Add pre/post-save hooks for audit and logging.
* Use pagination in all `find()` queries.

#### âœ… 8. Final Checks

* Run backend linter and formatter.
* Verify all routes and services still function correctly.
* Confirm the backend build passes health check and unit tests.
* Export final structure diagram as documentation.

---

### âœ… Expected Outcome

* Backend folder structure clean, scalable, and future-proof.
* No unnecessary code or collections remain.
* Database queries optimized and simplified.
* Imports and exports consistent across files.
* Inline comments and folder-level documentation complete.
* Backend becomes production-grade, maintainable, and developer-friendly.

---

âš ï¸ **Important:**
Do **not** modify or interact with any frontend code or files.
Focus only on the backend refactor and cleanup.
